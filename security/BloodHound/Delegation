Unconstrained Delegation
(userAccountControl=TrustedForDelegation)
Trust to any service
SeEnableDelegationPrivilege
msDS-AllowedToDelegateTo
Stores TGT in memory and used to get TGS for delegated service. TGT can be extracted from memory
    • Works across trusts

Traditional Constrained
(userAccountControl=TrustedToAuthForDelegation)
Trust TO specific services
msDS-AllowedToDelegateTo (to SPN of target resource)
    • SPNs you can Impersonate users to
Attack acct must have SPN
    • S4UProxy; Attack acct does not need SPN but service must have FORWARDABLE flag set
S4U Impersonation

Resource Based Constrained Delegation
(userAccountControl=TrustedToAuthForDelegation)
Trust FROM specific services
set msDS-AllowedToActOnBehalfOfOtherIdentity to resource (computer/user) that you have password or hash for (resouce must have an SPN)
Use PowerMad to set the security descriptors and the SID from the resource above
    * If you do not have a resource you can try Machine Quota and create a new machine using PowerMad
    * Powerview display ms-ds-machinecountquota: Get-DomainObject -Identity "dc=offense,dc=local" -Domain offense.local
Add SID of resource above to attribute
S4U Impersonation
